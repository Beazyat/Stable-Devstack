یکی از مشکلات مهم Devstack عدم پایداری آن به خصوص پس از ریستارت کردن سیستم یا VM مورد نظر است به‌طوری که نیاز است حتما از Snapshot هایی برای کار با آن استفاده نمایید و در غیر این صورت و به خصوص خاموش شدن ناگهانی VM یا سیستم نیاز به صرف زمان زیادی برای دیپلوی دوباره آن است. از این رو در این بخش تلاش بر آن است که این مشکلاتی احتمالی که را حل کرده و بتوانید Devstack را حتی روی سیستم خود یا روی VM بدون نگرانی استفاده کرده و در زمان شما تا حد زیادی صرفه‌جویی شود.
## Solve problem connection
ip aدر اولین گام لازم است که سرویس Openvswitch را که وظیفه ایجاد یک شبکه مجازی در هاست و هم‌چنین بخش زیادی از پیکربندی‌های مرتبط با Devstack را داراست را اجرا نموده و سپس در لیست سرویس‌هایی قرار دهید که همواره به محض شروع سیستم اجرا می‌شوند. برای این کار دستورات زیر را وارد نمایید:  
```bash
sudo systemctl start openvswitch-switch
sudo systemctl enable openvswitch-switch
```
در گام بعد پس از روشن نمودن دوباره سیستم خود یا پس از ریستارت حتما لیست شبکه‌های خود را با دستور:   
```bash
ip a 
# یا از دستور زیر استفاده نمایید
ifconfig
```
تست نمایید و بررسی نمایید آیا Bridge با نام br-ex وجود دارد و سپس آیا از یک رنج IP مشخص برخورد است یا خیر. رنج IP مورد نظر نیز به شکل ۱۷۲.۲۴.۴.۱/۲۴ است.  
در صورت عدم مشاهده، IP مورد نظر دستورات زیر را وارد نمایید:  
```bash
sudo ovs-vsctl add-br br-ex # ایجاد پل
sudo ip addr add 192.168.1.70/24 dev br-ex # IP اینترنت
sudo ip addr add 172.24.4.1/24 dev br-ex # Public devstack
sudo ip link set br-ex up # فعال ردن دست
sudo ip route add default via 192.168.1.70 dev br-ex
```
در این ساختار، `br-ex` به عنوان یک Bridge یا پل نرم‌افزاری عمل می‌کند که مشابه یک سوییچ در سطح لایه‌ی دوم شبکه است. این پل می‌تواند شامل چندین IP از رنج‌های مختلف باشد؛ برای مثال یک IP از subnet فیزیکی (مثل `192.168.1.x`) و یک IP برای رنج شناور DevStack (مثل `172.24.4.x`).  
تا زمانی که کارت شبکه‌ی فیزیکی `enp8s0` (نام کارت شبکه فیزیکی بسته به سیستم شما متفاوت است و با دستورات گفته شده آن را بیابید) به این پل متصل نشده باشد، `br-ex` فقط شبکه‌های داخلی DevStack را به هم متصل می‌کند ولی به اینترنت دسترسی ندارد. اتصال `enp8s0` به `br-ex` باعث می‌شود ترافیک از شبکه فیزیکی عبور کرده و ماشین‌های مجازی از طریق Floating IP بتوانند با بیرون ارتباط برقرار کنند.   
در نتیجه، `br-ex` مانند یک سوییچ مجازی عمل می‌کند که هم هاست میزبان و هم ماشین‌های DevStack را به شبکه و اینترنت متصل می‌کند.  
حال در گام آخر برای پورت کردن کارت شبکه فیزیکی به پل از دستور اول و سپس از دستور دوم برای اضافه کردن IP های مرتبط به نمونه‌ها یا ماشین‌های مجازی موجود در Devstack به IPtable استفاده می‌کنیم. با یاد‌آور شویم که نام کارت شبکه شما ممکن است متفاوت باشد اما به‌راحتی با دستوراتی هم‌چون`ifconfig` قابل یافتن است.  
```bash
sudo ovs-vsctl add-port br-ex enp8s0
sudo iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o br-ex -j MASQUERADE
```
پس از انجام این تنظیمات می‌توانید با ساخت یک نمونه ( Instance ) و گرفتن پینگ از آن با استفاده از هاست خود از انجام کامل و درست این عملیات اطمینان حاصل فرمایید.  
**تذکر:** برای بررسی ارتباط میان نمونه و هاست یا سیستمی که Devstack روی آن نصب است، اطمینان حاصل کنید که در دسترسی‌های مربوط به فایروال هر نمونه امکان ارسال و دریافت پکت ICMP و یا SSH امکان پذیر و در درسترس باشد.  
## Check All service work
مشکل بعدی که باید پیش از روشن شدن سیستمی که Devstack از پیش روی آن نصب شده بررسی کرده و حل نمایید، بررسی سرویس‌هایی هست که اجرا و کارکرد درست آن‌ها تضمین‌کننده وضعیت مناسب و امکان استفاده از Devstack است. برای بررسی همه سرویس‌های مرتبط به Devstack ابتدا دستور زیر را وارد کرده و سپس از طریق همین دستور و در هر سطر می‌توانید وضعیت هر سرویس و در حال اجرا یا عدم اجرا بودن آن را بررسی نمایید:  
```bash
systemctl list-units --type=service | grep devstack@
```
پس از اجرای این دستور در مقابل هر سرویس بررسی نمایید که در وضعیت Active قرار دارد یا خیر. اگر یک سرویس در وضعیت Failed بود باید نام آن سرویس را کپی کرده و در نمونه دستور زیر قرار داده و اجراه نمایید:  
```bash
sudo systemctl restart service-name
```
و سپس برای بررسی این‌که آیا سرویس به وضعیت مطلوب خود که حالت active است بازگشته است یا خیر از دستور زیر استفاده نموده یا دوباره به دستوری که لیستی از سرویس‌ها را نمایش می‌داد مراجعه فرمایید:  
```bash
sudo systemctl status service-name
```
**نکته‌مهم:** یکی از سرویس‌هایی که اغلب در حین اجرای سیستم و از سر گرفتن اجرای Devstackبا مشکل مواجه خواهد شد سرویس Nova است؛ از این رو لازم به ذکر است پس از هر بار روشن نمودن سیستم وضعیت این سرویس را بررسی نموده و در صورت failed بودن آن را ریستارت کنید تا از سلامت این سرویس و اجرای کامل Devstack اطمینان حاصل فرمایید:  
```bash
sudo systemctl restart devstack@n-cpu.service
```
## Solve Volume problem
یکی دیگر از مشکلاتی که ممکن است در حین اجرای Devstack پس از ریستارت کردن سیستم خود با آن مواجه شوید، مشکل عدم شناسایی پارتیشنی است که Devstack در سرور یا سیستم شما برای استفاده خود و  هم‌چنین سپردن آن به نمونه‌ها یا همان ماشین‌های مجازی Devstack استفاده می‌کند.   لازم به ذکر است اغلب حجمی که از سیستم شما به این پارتیشن اختصاص داده می‌شود حدود ۳۰ گیگابایت است که در زمان دیپلوی کردن این پروژه و در فایل local.conf قابل تنظیم و افزایش است که در بخش نحوه نصب [Devstack](How-to-install-Devstack.md) درباره آن توضیح داده شده است.  
### Check Volume of Devstack
در لینوکس حافظه شما توسط LVM ( Logical Volume Manager ) که یک لایه انتزاعی است مدیریت شده و به شما امکان پارتیشن‌بندی می‌دهد، افزایش حجم پارتیشن ها یا یا گرفتن snapshot و یا اتصال چند واحد حافظه و یکپارچه‌سازی آن‌ها را می‌دهد (مرتبط با بحث مجازی‌سازی حافظه ).   
پروژه Devstack در حین دیپلوی یک Volume یا همان پارتیشن برای استفاده خود ایجاد می‌کند که آن را باید به یک Loop که منظور فایل‌هایی است که سیستم شما شبیه به یک حافظه سخت‌افزاری با آن‌ها برخورد می‌کند متصل شود. حال اگر به جای لوپ یا همان حافظه سخت افزاری مجازی که Devstack تصمیم گرفته Volume خود را به آن متصل کند، در زمان روشن سیستم، ولوم Devstack به Loop دیگری متصل شود ممکن است ایجاد مشکل شود.   علت این اتفاق نیز بدین دلیل است که ممکن است آن Loop توسط سیستم، جزو لوپ‌های مجاز شناسایی نشده باشد یا دسترسی برای اجرای آن داده نشده باشد. از این رو لازم است که شما با ورود به فایل‌های سیستمی مربوطه تعیین کنید که همواره ولوم ( Volume ) مرتبط با Devstack به یک لوپ متصل شود و آن را همواره مجاز به اجرا نمایید؛ اما بدلیل محیط آزمایشی و روند طولانی‌تر به سیستم دستور می‌دهیم تا همه لوپ‌ها را مجاز تشخیص دهد تا از پیچیدگی بیش‌تر در حین روند اجرای Devstack جلوگیری شود؛ اما اگر به‌دنبال حل دقیق این مشکل و اتصال دائمی ولوم Devstack به یک لوپ هستید، بخش Connet Volume to Static loop را مطالعه فرمایید.  
ابتدا برای یافتن ولوم مرتبط با Devstack باید دستور زیر را وارد نمایید:  
```bash
sudo losetup -a | grep stack
```
با وارد کردن این دستور لوپی را که ولوم Devstack به آن متصل شده است مشاهده خواهید نمود. در صورت **عدم نمایش** لازم است که دوباره کارکرد سرویس Cinder رو مشاهده مرحله دوم بررسی نمایید یا این که دوباره از اول Devstack را اجرا نمایید.  
در گام بعد باید بررسی کنیم که آیا LVM به این لوپ یا لوپ‌های دیگر اجازه اجرا داده است یا خیر؟  
با اجرای دستور زیر وارد فایل تنظیمات LVM خواهیم شد و در آن تعیین خواهیم نمود که LVM به همه لوپ‌ها اجازه اجرا دهد.  
```bash
sudo nano /etc/lvm/lvm.conf
```
سپس باید بخش devices را در این فایل متنی یافته و متنی که Devstack پیش از شما قرار داده است را پاک نموده و به این بخش متن زیر را اضافه نمایید: ( دقت نمایید حتما باید زیر devices و در براکت مرتبط با آن اضافه گردد.)  
```bash
    filter = [ "a|/dev/loop.*|", "r|.*|" ]
    global_filter = [ "a|/dev/loop.*|", "r|.*|" ]
```
سپس فایل متنی را ذخیره کرده و برای اسکن لوپ‌ها دستور زیر را وارد نمایید:  
```bash
sudo pvscan
```
سپس در این مرحله باید نام لوپی که ولوم Devstack از آن استفاده می‌کرد را در دستور زیر وارد نمایید تا LVM آن را برای شما به عنوان یک حافظه فیزیکی آماده کند.   
```bash
sudo vgcreate stack-volumes-lvmdriver-1 /dev/loopx
# x باید معادل عدد ولوم خروجی در دستور losetup باشد.
```
سپس با این دستور پایین فرآیند‌ بالا را تایید نمایید که باید در خروجی آن عبارت` stack-volumes-lvmdriver-1 `وجود داشته باشد.  
```bash
sudo vgs
```
در ریستارت‌ها یا دفعات بعد برای استفاده از Devstack و Cinder مشکلی نخواهد بود. فقط برای اطمینان یک‌بار دیگر سرویس CInder را ریستارت نمایید:  
```bash
sudo systemctl restart devstack@c-vol.service
```